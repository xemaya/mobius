# Mobius â€” AI å°è¯´åˆ›ä½œå¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

> **ç‰ˆæœ¬**: v2.1ï¼ˆå¤±æ§å‹å™äº‹å¼•æ“ï¼‰ğŸ”¥
> **å®šä½**: è®©è§’è‰²å¸¦ç€åè§åšé”™äº‹ï¼Œè®©ä¸–ç•Œè‡ªè¡Œå¤±æ§ï¼Œè®©æ•…äº‹è‡ªç„¶å´©åã€‚

## ğŸ”¥ v2.2 æ ¸å¿ƒè¿›åŒ–ï¼šæ–‡é£å†·å´ä¸å¼ å¼›ç»“æ„

åœ¨ v2.1 "å¤±æ§å‹å™äº‹å¼•æ“" çš„åŸºç¡€ä¸Šï¼ŒMobius å¼•å…¥äº†æ›´æ·±å±‚çš„æ–‡é£ç®¡æ§æœºåˆ¶ï¼Œæ—¨åœ¨ä»æ ¹æœ¬ä¸Šè§£å†³ AI åˆ›ä½œä¸­å¸¸è§çš„"æ–‡å­—è¿‡çƒ­"ã€"å¥å¥ç”¨åŠ›"å’Œ"å“²å­¦åŒ–è‡ªè§‰"ç­‰é—®é¢˜ã€‚

### æ ¸å¿ƒç†å¿µï¼šä»"æŒç»­é«˜æ½®"åˆ°"æœ‰å‘¼å¸æ„Ÿ"

**ç›®æ ‡**ï¼šä¸å†è¿½æ±‚æ¯ä¸€å¥éƒ½æ¼‚äº®ï¼Œè€Œæ˜¯å…è®¸å¹³åº¸ã€å…è®¸å†·åœºã€å…è®¸å¤±è¯¯ã€å…è®¸ç©ºç™½ã€‚

### æ–°å¢æ ¸å¿ƒæœºåˆ¶

1. **æ–‡é£æ§åˆ¶å™¨ (Style Governor)**: ç‹¬ç«‹çš„åå¤„ç†å±‚ï¼Œå¼ºåˆ¶æ‰§è¡Œæ¯”å–»å¯†åº¦é™åˆ¶ã€æŠ½è±¡è¯å‹ç¼©å’Œæ™®é€šå¥æ¯”ä¾‹ã€‚
2. **å¼ å¼›ç®—æ³• (Rhythm Engine)**: å¾ªç¯èŠ‚å¥æ§åˆ¶ï¼ˆé«˜å¼ åŠ› -> å†·å´ -> æ—¥å¸¸ -> æ„å¤– -> æ²‰é»˜ -> å†çˆ†å‘ï¼‰ï¼Œå¼ºåˆ¶åœ¨æƒ…ç»ªçˆ†å‘åæ’å…¥ä½èƒ½é‡æ®µã€‚
3. **è§’è‰²å¤±è¯¯æ¨¡å— (Human Error Engine)**: å¼ºåˆ¶è§’è‰²æ¯ 2 ç« çŠ¯ä¸€ä¸ªéæˆ˜ç•¥æ€§é”™è¯¯ï¼ˆè¯¯åˆ¤ã€å¤±æ§ã€æ’’è°ï¼‰ï¼Œå¹¶äº§ç”Ÿä¸å¯é€†çš„çœŸå®åæœã€‚
4. **æ¼‚äº®è¯åˆ å‡ç­–ç•¥**: è‡ªåŠ¨è¯†åˆ«å¹¶åˆ æ‰ç« èŠ‚ä¸­è¯»ç€æœ€â€œçˆ½â€ã€æœ€åä¸½çš„ 20% å¥å­ï¼Œä¿ç•™éª¨æ¶ï¼Œåˆ¶é€ å¼ åŠ›ã€‚

---

## ç›®å½•

1. [ç³»ç»Ÿç›®æ ‡](#1-ç³»ç»Ÿç›®æ ‡)
2. [è®¾è®¡å“²å­¦](#2-è®¾è®¡å“²å­¦)
3. [äº§å“æ¶æ„](#3-äº§å“æ¶æ„)
4. [æŠ€æœ¯æ¶æ„](#4-æŠ€æœ¯æ¶æ„)
5. [åŒå¾ªç¯æµæ°´çº¿](#5-åŒå¾ªç¯æµæ°´çº¿)
6. [æ ¸å¿ƒå­ç³»ç»Ÿè¯¦è§£](#6-æ ¸å¿ƒå­ç³»ç»Ÿè¯¦è§£)
7. [æ•°æ®æ¨¡å‹å…¨è§ˆ](#7-æ•°æ®æ¨¡å‹å…¨è§ˆ)
8. [Agent å…¨è§ˆ](#8-agent-all-view)
9. [LLM æŠ½è±¡å±‚](#9-llm-æŠ½è±¡å±‚)
10. [çŠ¶æ€ç®¡ç†](#10-çŠ¶æ€ç®¡ç†)
11. [YAML è®¾å®šé›†è§„èŒƒ](#11-yaml-è®¾å®šé›†è§„èŒƒ)
12. [é¡¹ç›®ç»“æ„](#12-é¡¹ç›®ç»“æ„)
13. [ä½¿ç”¨æ–¹å¼](#13-ä½¿ç”¨æ–¹å¼)
14. [æ‰©å±•æŒ‡å—](#14-æ‰©å±•æŒ‡å—)
15. [é™„å½•ï¼šå¤±æ§å‹å™äº‹å¼•æ“ (v2.x)](#68-å¤±æ§å‹å™äº‹å¼•æ“-chaos-engine-v21)

---

## 1. ç³»ç»Ÿç›®æ ‡

### 1.1 æ ¸å¿ƒæ„¿æ™¯

**è®©è§’è‰²æ‹¥æœ‰çµé­‚ï¼Œè®©ä¸–ç•Œè‡ªè¡Œæ¼”åŒ–ï¼Œè®©æ•…äº‹è‡ªç„¶å‘ç”Ÿã€‚**

ä¼ ç»Ÿçš„ AI å†™ä½œå·¥å…·æ˜¯"å‰§æœ¬é©±åŠ¨"â€”â€”AI æŒ‰ç…§äººç±»ç»™å®šçš„å¤§çº²é€æ®µç”Ÿæˆæ–‡å­—ã€‚Mobius çš„è®¾è®¡ç›®æ ‡æ˜¯ä»æ ¹æœ¬ä¸Šé¢ è¦†è¿™ä¸ªèŒƒå¼ï¼š

| ç»´åº¦ | ä¼ ç»Ÿ AI å†™ä½œ | Mobius |
|------|------------|--------|
| å‰§æƒ…æ¥æº | å¤§çº² â†’ ç« èŠ‚ â†’ æ®µè½ | è§’è‰²æ¬²æœ›ç¢°æ’ â†’ å†²çªè‡ªç„¶äº§ç”Ÿ |
| è§’è‰²å®šä½ | æŒ‰å‰§æœ¬æ¼”å‡ºçš„æ¼”å‘˜ | æ‹¥æœ‰ç‹¬ç«‹ä¿¡å¿µå’Œæ¬²æœ›çš„è‡ªæ²»ä½“ |
| ä¸–ç•Œè§‚ | é™æ€èƒŒæ™¯æ¿ | å¸¦æœ‰ç‰©ç†çŠ¶æ€æ€»çº¿çš„åŠ¨æ€ç¯å¢ƒ |
| å™äº‹è§†è§’ | å•ä¸€å…¨çŸ¥è§†è§’ | å¤šè§†è§’äº¤å‰ï¼ˆä¸»çº¿ + æ”¯çº¿è§‚å¯Ÿè€…ï¼‰ |
| è§’è‰²æˆé•¿ | å±æ€§æ•°å€¼å˜åŒ– | ä¿¡å¿µå±‚çº§é‡æ’ï¼ˆæ ¸å¿ƒä¿¡å¿µå´©è§£ = äººç‰©é‡å¤§è½¬æŠ˜ï¼‰ |
| è´¨é‡æ§åˆ¶ | æ—  | ä¸»é¢˜å®ˆæŠ¤ + å¼ åŠ›æ§åˆ¶ + è‡ªæˆ‘æ‰¹è¯„ä¸‰åˆä¸€è¯„å®¡ |

### 1.2 å…·ä½“èƒ½åŠ›

- **ä¸–ç•Œæ¨¡æ‹Ÿå±‚**: è§’è‰²åœ¨æ²¡æœ‰å‰§æƒ…æ¨åŠ¨æ—¶ä¹Ÿä¼š"æ€è€ƒ"ï¼Œæ‹¥æœ‰è‡ªå·±çš„é•¿æœŸç›®æ ‡ï¼Œåœ¨æ— äººè§‚å¯Ÿæ—¶ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–
- **æ¬²æœ›é©±åŠ¨å™äº‹**: å†²çª = æ¬²æœ›ç›¸æ’ï¼Œåªè¦æ¬²æœ›å›¾å­˜åœ¨ï¼Œæ•…äº‹å°±ä¼šè‡ªç„¶å‘ç”Ÿ
- **èµ„æºç»æµ**: è¡ŒåŠ¨æœ‰æˆæœ¬ï¼Œå†³ç­– = æœ‰é™èµ„æºä¸‹çš„é€‰æ‹©
- **ä¿¡å¿µæ¼”åŒ–**: è§’è‰²æˆé•¿ = ä¿¡å¿µå±‚çº§é‡æ’ï¼Œè€Œéç®€å•çš„å±æ€§æ•°å€¼å˜åŒ–
- **è®¤çŸ¥é»‘ç®±**: è§’è‰²ç”Ÿæˆç§æœ‰å†…å¿ƒç‹¬ç™½åå†ç”Ÿæˆå¤–æ˜¾è¡Œä¸ºï¼Œäº§ç”Ÿ"è¨€ä¸ç”±è¡·"çš„æ–‡å­¦æ·±åº¦
- **ç¯å¢ƒäº’åŠ¨**: ç‰©ç†çŠ¶æ€æ€»çº¿ï¼ˆå¦‚"è­¦æŠ¥ç­‰çº§"ã€"ç®—åŠ›ä½™é‡"ï¼‰ç›´æ¥å½±å“è§’è‰²å†³ç­–
- **å¤šè§†è§’å™äº‹**: ç³»ç»Ÿæ—¥å¿—ã€è·¯äººã€æ®‹ç•™æ•°æ®ç‰‡æ®µç­‰éä¸»è§’è§†è§’å¢åŠ å™äº‹ç©ºé—´æ„Ÿ
- **è‡ªæˆ‘è¿›åŒ–**: ç« èŠ‚è¯„å®¡æœºåˆ¶ç¡®ä¿ä¸»é¢˜ä¸æ¼‚ç§»ã€èŠ‚å¥æœ‰å¼ åŠ›ã€é€»è¾‘ä¸å´©å¡Œ

---

## 2. è®¾è®¡å“²å­¦

### 2.1 äº”å¤§åŸåˆ™

**åŸåˆ™ä¸€ï¼šä¸–ç•Œå…ˆäºæ•…äº‹**

ä¸–ç•Œæ˜¯æŒç»­è¿è½¬çš„æ¨¡æ‹Ÿï¼Œæ•…äº‹æ˜¯ä»ä¸­"è£å‰ª"å‡ºæ¥çš„ã€‚World Observer Agent åªé€‰æ‹©é«˜å™äº‹ä»·å€¼çš„äº‹ä»¶å†™å…¥å°è¯´ï¼Œä½†ä¸–ç•Œæœ¬èº«ä¸ä¼šå› ä¸º"ä¸å¥½çœ‹"è€Œåœæ­¢è¿è¡Œã€‚è£å‰ª â‰  å¹²é¢„ã€‚

**åŸåˆ™äºŒï¼šæ¬²æœ›é©±åŠ¨ï¼Œè€Œéå‰§æœ¬é©±åŠ¨**

å¯¼æ¼”ï¼ˆDirectorï¼‰çš„è§’è‰²ä»"å‰§æœ¬ä½œè€…"å˜ä¸º"ç¼–æ’è€…"ã€‚ä»–ä¸å‡­ç©ºåˆ›é€ å†²çªï¼Œè€Œæ˜¯ä»è§‚å¯Ÿè€…æ ‡è®°çš„é«˜ä»·å€¼ä¸–ç•Œäº‹ä»¶ä¸­é€‰æ‹©ç´ æï¼Œå†ç”¨è§’è‰²çš„æ¬²æœ›ææ¡ˆæ¥ç»„ç»‡åœºæ™¯ã€‚

**åŸåˆ™ä¸‰ï¼šè¡ŒåŠ¨æœ‰ä»£ä»·**

å¼•å…¥å…­ç»´èµ„æºç³»ç»Ÿï¼ˆæ—¶é—´ã€å£°èª‰ã€æƒåŠ›ã€ä¿¡æ¯ã€æƒ…ç»ªèƒ½é‡ã€è´¢å¯Œï¼‰ã€‚è§’è‰²çš„æ¯æ¬¡å†³ç­–éƒ½æ˜¯åœ¨æœ‰é™èµ„æºä¸‹çš„é€‰æ‹©ã€‚å½“æƒ…ç»ªèƒ½é‡è€—å°½ï¼Œè§’è‰²ä¸å†ç†æ€§ï¼›å½“å£°èª‰å½’é›¶ï¼Œè§’è‰²å¤±å»ç¤¾ä¼šèµ„æºã€‚è¿™è®©å™äº‹æœ‰äº†"é‡é‡"ã€‚

**åŸåˆ™å››ï¼šä¿¡å¿µä¸æ˜¯æ ‡ç­¾**

è§’è‰²ä¸æ˜¯ç”¨ä¸€ç»„å½¢å®¹è¯å®šä¹‰çš„ã€‚ä¸‰å±‚ä¿¡å¿µç³»ç»Ÿï¼ˆcore â†’ middle â†’ surfaceï¼‰è®©è§’è‰²å¯ä»¥ï¼š
- è‡ªæˆ‘æ€€ç–‘
- æ¨ç¿»æ—§ä¿¡å¿µ
- å½¢æˆæ–°çš„è¡Œä¸ºæ¨¡å¼

å½“ core ä¿¡å¿µçš„å¼ºåº¦é™è‡³ 0.2 ä»¥ä¸‹æ—¶ä¼š"å´©è§£"ä¸º middle å±‚â€”â€”è¿™æ˜¯è§’è‰²çš„äººæ ¼åœ°éœ‡ï¼Œä¹Ÿæ˜¯å°è¯´ä¸­æœ€çè´µçš„è½¬æŠ˜ç‚¹ã€‚

**åŸåˆ™äº”ï¼šæ€ç»´è´¨æ„Ÿå·®å¼‚åŒ–**

ä¸åŒè§’è‰²å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ¨¡å‹å’Œå‚æ•°ã€‚ç»“æ„åŒ–å†³ç­–ï¼ˆä¿¡å¿µå˜æ›´è®¡ç®—ï¼‰ç”¨ Geminiï¼Œè§’è‰²æ‰®æ¼”å¯¹è¯å’Œå†…å¿ƒæ´»åŠ¨ç”¨ MiniMax M2-herã€‚è¿™è®©è§’è‰²çš„"æ€ç»´æ–¹å¼"çœŸæ­£ä¸åŒï¼Œè€Œéä»…ä»…æ˜¯"äººæ ¼æ¨¡æ¿åˆ‡æ¢"ã€‚

### 2.2 è®¤çŸ¥é»‘ç®±æœºåˆ¶

çµæ„Ÿæ¥æºï¼šç°å®ä¸­äººä»¬ä»æ¥ä¸æ˜¯"ç›´è¨€ä¸è®³"çš„ã€‚æ¯ä¸ªäººåœ¨å¼€å£å‰éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨å®¡æŸ¥è¿‡ç¨‹ã€‚

Mobius çš„è§’è‰² Agent é‡‡ç”¨ä¸¤é˜¶æ®µç”Ÿæˆï¼š

```
Stage 1ï¼ˆç§æœ‰ï¼‰: "å†™å‡ºä½ æ­¤åˆ»çœŸå®çš„å†…å¿ƒç‹¬ç™½â€”â€”ææƒ§ã€çœŸå®æƒ³æ³•ã€ä¸å¯å‘Šäººçš„åŠ¨æœºã€‚"
                  â†’ internal_monologueï¼ˆä¸å‘å…¶ä»–è§’è‰²å…¬å¼€ï¼‰

Stage 2ï¼ˆå¤–æ˜¾ï¼‰: "ä½ çš„çœŸå®æƒ³æ³•æ˜¯ {monologue}ï¼Œä½†ä½ ç°åœ¨å¿…é¡»åœ¨ä»–äººé¢å‰è¡ŒåŠ¨ã€‚
                  ä½ å®é™…ä¸Šä¼šè¯´ä»€ä¹ˆã€åšä»€ä¹ˆï¼Ÿæ³¨æ„â€”â€”ä½ ä¸ä¸€å®šè¦è¯´å‡ºçœŸå¿ƒè¯ã€‚"
                  â†’ contentï¼ˆå…¶ä»–è§’è‰²å’Œè¯»è€…çœ‹åˆ°çš„ï¼‰
```

å…³é”®è§„åˆ™ï¼š
- è§’è‰² A çš„ `internal_monologue` **ä¸ä¼š**è¿›å…¥è§’è‰² B çš„ context
- ä½†å™äº‹ Agent **å¯ä»¥çœ‹åˆ°**æ‰€æœ‰è§’è‰²çš„ `internal_monologue`
- å™äº‹ Agent ç”¨å¾®è¡¨æƒ…ã€ç¯å¢ƒæå†™ã€è¯­æ°”è¯ç­‰æ–‡å­¦æ‰‹æ³•**æš—ç¤º**æ½œå°è¯ï¼Œè€Œéç›´ç™½è¯´å‡º

è¿™äº§ç”Ÿäº†"è¨€ä¸ç”±è¡·"çš„æ•ˆæœâ€”â€”æ—æ™šæ™´å˜´ä¸Šåœ¨èµ¶è‹è–‡èµ°ï¼Œä½†è¯»è€…èƒ½ä»ç»†å¾®çš„æå†™ä¸­æ„Ÿå—åˆ°å¥¹çš„çœŸå®æƒ³æ³•æ˜¯"æˆ‘ä¸èƒ½è®©ä½ ç‰µæ‰¯è¿›æ¥"ã€‚

---

## 3. äº§å“æ¶æ„

### 3.1 å››å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Meta / Observation Layer                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ World        â”‚ â”‚ Theme        â”‚ â”‚ Self-Critique +      â”‚ â”‚
â”‚  â”‚ Observer     â”‚ â”‚ Guardian     â”‚ â”‚ Tension Controller   â”‚ â”‚
â”‚  â”‚ + Secondary  â”‚ â”‚              â”‚ â”‚ (Reviewer Agent)     â”‚ â”‚
â”‚  â”‚ Viewpoints   â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                â”‚                     â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚     Orchestration Layer               â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Director /   â”‚ â”‚ Memory       â”‚ â”‚ Environment Engine   â”‚ â”‚
â”‚  â”‚ Orchestrator â”‚ â”‚ Distiller    â”‚ â”‚ (Physical State Bus) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                      â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚     World Simulation Layer            â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Conflict     â”‚              â”‚ Resource Economy          â”‚ â”‚
â”‚  â”‚ Engine       â”‚              â”‚                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚     Character Layer (M2-her Powered)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Character A  â”‚ â”‚ Character B  â”‚ â”‚ Character N          â”‚ â”‚
â”‚  â”‚ Stage1: Mono â”‚ â”‚ Stage1: Mono â”‚ â”‚ Stage1: Monologue    â”‚ â”‚
â”‚  â”‚ Stage2: Act  â”‚ â”‚ Stage2: Act  â”‚ â”‚ Stage2: Action       â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â”‚ Belief   â”‚ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â”‚ Desire   â”‚ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â”‚ Fear     â”‚ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â”‚ Resource â”‚ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â”‚ Memory   â”‚ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚              â”‚ â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç”¨æˆ·äº¤äº’ç•Œé¢

Mobius é€šè¿‡ CLI ä¸ç”¨æˆ·äº¤äº’ï¼Œæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

- **æ‰¹é‡æ¨¡å¼** (`mobius generate setting.yaml`): ä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´å°è¯´
- **äº¤äº’æ¨¡å¼** (`mobius generate setting.yaml -i`): é€ç« ç”Ÿæˆï¼Œç”¨æˆ·å¯åœ¨ç« èŠ‚é—´æŸ¥çœ‹è§’è‰²çŠ¶æ€ã€å†³å®šæ˜¯å¦ç»§ç»­

---

## 4. æŠ€æœ¯æ¶æ„

### 4.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|---------|------|
| ç¼–æ’æ¡†æ¶ | **LangGraph** (StateGraph) | æœ‰çŠ¶æ€çš„å¤š Agent å·¥ä½œæµï¼Œæ”¯æŒæ¡ä»¶è·¯ç”±å’Œ Checkpoint |
| æ•°æ®æ¨¡å‹ | **Pydantic v2** | ä¸¥æ ¼çš„ç±»å‹éªŒè¯ï¼Œç¡®ä¿ Agent é—´æ•°æ®ä¼ é€’çš„æ­£ç¡®æ€§ |
| LLM æ¨ç† | **Gemini 3 Flash** (é»˜è®¤) | ç»“æ„åŒ–å†³ç­–ã€JSON ç”Ÿæˆã€ç« èŠ‚è§„åˆ’ |
| è§’è‰²æ‰®æ¼” | **MiniMax M2-her** (å¯é€‰) | æ·±åº¦è§’è‰²æ‰®æ¼”ï¼Œç‹¬æœ‰çš„ user_system/sample_message è§’è‰² |
| LLM æŠ½è±¡ | **LangChain Core** | BaseChatModel ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒå¤š Provider |
| çŠ¶æ€æŒä¹…åŒ– | **InMemorySaver** | LangGraph å†…ç½® Checkpointer |
| CLI | **Rich** + argparse | ç¾è§‚çš„ç»ˆç«¯è¾“å‡ºå’Œè¿›åº¦å±•ç¤º |
| é…ç½® | **PyYAML** | äººç±»å¯è¯»çš„è®¾å®šé›†æ–‡ä»¶ |

### 4.2 ä¾èµ–å…³ç³»

```
pyproject.toml:
  langgraph >= 0.4
  langchain-core >= 0.3
  langchain-openai >= 0.3        # OpenAI å…¼å®¹
  langchain-google-genai >= 2.0  # Google Gemini
  httpx >= 0.27                  # MiniMax API è°ƒç”¨
  pydantic >= 2.0
  pyyaml >= 6.0
  rich >= 13.0
```

---

## 5. åŒå¾ªç¯æµæ°´çº¿

Mobius é‡‡ç”¨**åŒå¾ªç¯æ¶æ„**ï¼Œå°†"ä¸–ç•Œæ¨¡æ‹Ÿ"å’Œ"å™äº‹å‘ˆç°"è§£è€¦ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Inner Loop: World Simulation            â”‚
                    â”‚                                                â”‚
                    â”‚  env_update â”€â”€â–º desire_tick â”€â”€â–º conflict_detect â”‚
                    â”‚       â–²                              â”‚         â”‚
                    â”‚       â”‚                              â–¼         â”‚
                    â”‚  distill_memory â—„â”€â”€ ... â—„â”€â”€ observer_mark      â”‚
                    â”‚       â”‚                              â”‚         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       â”‚   Outer Loop: Narrative       â”‚         â”‚
                    â”‚       â”‚                              â–¼         â”‚
                    â”‚  distill_memory    plan_chapter â—„â”€â”€â”€â”€â”˜         â”‚
                    â”‚       â–²                 â”‚                      â”‚
                    â”‚       â”‚                 â–¼                      â”‚
                    â”‚  review_chapter    direct_scene                â”‚
                    â”‚       â–²                 â”‚                      â”‚
                    â”‚       â”‚                 â–¼                      â”‚
                    â”‚  (viewpoints)    scene_execute                 â”‚
                    â”‚       â–²          (action/interact)             â”‚
                    â”‚       â”‚                 â”‚                      â”‚
                    â”‚  compile_chapter â—„â”€â”€â”€â”€â”€â”€â”˜                      â”‚
                    â”‚                                                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.1 å†…å¾ªç¯ï¼šä¸–ç•Œæ¨¡æ‹Ÿ

æ¯ç« å¼€å§‹å‰æ‰§è¡Œï¼Œæ¨¡æ‹Ÿä¸–ç•Œçš„è‡ªç„¶è¿è½¬ï¼š

| æ­¥éª¤ | èŠ‚ç‚¹ | èŒè´£ |
|------|------|------|
| 1 | `env_update` | ç¯å¢ƒå˜é‡æŒ‰ decay_rate è‡ªç„¶è¡°å‡ï¼›è§’è‰²èµ„æºæŒ‰ recovery_rate å›å¤ |
| 2 | `desire_tick` | æ¯ä¸ªè§’è‰²æ ¹æ®æ¬²æœ›ä¼˜å…ˆçº§å’Œèµ„æºçŠ¶å†µæå‡ºè¡ŒåŠ¨ææ¡ˆ (DesireProposal) |
| 3 | `conflict_detect` | å†²çªå¼•æ“æ£€æµ‹æ¬²æœ›ç¢°æ’ã€èµ„æºäº‰å¤ºã€ææƒ§è§¦å‘ï¼Œç”Ÿæˆ WorldEvent |
| 4 | `observer_mark` | ä¸–ç•Œè§‚å¯Ÿè€…ç”¨ LLM è¯„ä¼°æ¯ä¸ªäº‹ä»¶çš„å™äº‹ä»·å€¼ï¼Œé€‰å‡ºé«˜ä»·å€¼äº‹ä»¶ |

### 5.2 å¤–å¾ªç¯ï¼šå™äº‹å‘ˆç°

ä»è§‚å¯Ÿè€…æ ‡è®°çš„ç´ æä¸­ç¼–æ’å’Œå‘ˆç°ï¼š

| æ­¥éª¤ | èŠ‚ç‚¹ | èŒè´£ |
|------|------|------|
| 5 | `plan_chapter` | ç¼–æ’è€…ä» narrative_candidates + desire_proposals ä¸­ç»„ç»‡æœ¬ç« ç´ æ |
| 6 | `direct_scene` | ä»åœºæ™¯é˜Ÿåˆ—å–å‡ºä¸‹ä¸€ä¸ªåœºæ™¯ï¼Œæ ¹æ®ç±»å‹è·¯ç”± |
| 7 | `character_action` / `character_interact` | è§’è‰²æ‰§è¡ŒåŒé˜¶æ®µç”Ÿæˆï¼ˆå†…å¿ƒç‹¬ç™½ â†’ å¤–æ˜¾è¡ŒåŠ¨ï¼‰ |
| 8 | `update_state` | åº”ç”¨ä¿¡å¿µ/èµ„æº/æƒ…æ„Ÿ/ç¯å¢ƒå˜åŒ–ï¼Œæ£€æŸ¥è§¦å‘æ¡ä»¶ |
| 9 | `check_triggers` â†’ `handle_trigger` | å¤„ç†è§¦å‘äº‹ä»¶ |
| 10 | `compile_chapter` | å™äº‹ Agent èåˆå¤–æ˜¾è¡Œä¸º + æ½œå°è¯ + æ”¯çº¿è§†è§’ â†’ å°è¯´æ­£æ–‡ |
| 11 | `secondary_viewpoints` | æ”¯çº¿è§‚å¯Ÿè€…ç”Ÿæˆéä¸»è§’è§†è§’ç‰‡æ®µ |
| 12 | `review_chapter` | è¯„å®¡ Agent è¯„ä¼°ä¸»é¢˜/å¼ åŠ›/é€»è¾‘ï¼Œè¾“å‡º ChapterReview |
| 13 | `distill_memory` | è®°å¿†è’¸é¦ Agent å°†æ—§è®°å¿†å‹ç¼©ä¸ºç»“æ„åŒ–æ‘˜è¦ |

å¾ªç¯å›åˆ°æ­¥éª¤ 1 å¼€å§‹ä¸‹ä¸€ç« ï¼Œç›´åˆ°æ‰€æœ‰ç« èŠ‚å®Œæˆã€‚

---

## 6. æ ¸å¿ƒå­ç³»ç»Ÿè¯¦è§£

### 6.1 ä¿¡å¿µç³»ç»Ÿ (Belief System)

```python
class Belief:
    id: str               # å”¯ä¸€æ ‡è¯†
    statement: str         # "æŒæ§ä¸€åˆ‡æ‰èƒ½ä¿æŠ¤æ‰€çˆ±çš„äºº"
    layer: str             # "core" | "middle" | "surface"
    strength: float        # 0.0 - 1.0
    category: str          # "ä»·å€¼è§‚" | "ä¸–ç•Œè®¤çŸ¥" | "è¡Œä¸ºç­–ç•¥"
```

**ä¸‰å±‚ç»“æ„**ï¼š

| å±‚çº§ | æŠ—å˜ç³»æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|---------|------|------|
| core | 0.3 (ä»…æ¥å— 30% å˜åŒ–) | äººæ ¼åŸºçŸ³ï¼Œæéš¾æ”¹å˜ | "äººæ€§æœ¬å–„" |
| middle | 0.7 | å¯è¢«å‰§æƒ…åŠ¨æ‘‡ | "AIä¸åº”æ‹¥æœ‰æƒ…æ„Ÿ" |
| surface | 1.0 | è¡Œä¸ºç­–ç•¥ï¼ŒåŠ¨æ€æ›´æ–° | "å…ˆè§‚å¯Ÿå†è¡ŒåŠ¨" |

**ä¿¡å¿µæ¼”åŒ–äº‹ä»¶**ï¼š
- **å›ºåŒ–**ï¼šå½“ surface ä¿¡å¿µå¼ºåº¦ â‰¥ 0.95 æ—¶ï¼Œå‡çº§ä¸º middle å±‚
- **å´©è§£**ï¼šå½“ core ä¿¡å¿µå¼ºåº¦ â‰¤ 0.2 æ—¶ï¼Œé™çº§ä¸º middle å±‚ â† **è¿™æ˜¯å°è¯´ä¸­æœ€çè´µçš„è½¬æŠ˜ç‚¹**

### 6.2 æ¬²æœ›é©±åŠ¨ç³»ç»Ÿ (Desire Engine)

```python
class Desire:
    id: str
    description: str           # "æ‰¾åˆ°å¹¶æ‹¯æ•‘é™†è¾°"
    priority: float            # 0.0-1.0ï¼ŒåŠ¨æ€è°ƒæ•´
    category: str              # survival | belonging | power | self_actualization
    required_resources: dict   # {"time": 10, "reputation": -20}
    conflicts_with: list[str]  # ä¸å“ªäº›å…¶ä»–è§’è‰²çš„æ¬²æœ›å†²çª

class Fear:
    id: str
    description: str           # "å®³æ€•å¤±å»å¯¹é™†è¾°çš„æ§åˆ¶"
    intensity: float           # 0.0-1.0
    linked_desire: str         # ææƒ§å¾€å¾€æ˜¯æ¬²æœ›çš„åé¢
    avoidance_cost: float      # ä¸ºé€ƒé¿ææƒ§æ„¿æ„ä»˜å‡ºçš„èµ„æºä»£ä»·
```

**å·¥ä½œæµ**ï¼šæ¯ç« å¼€å§‹æ—¶ï¼Œæ¯ä¸ªè§’è‰²æ ¹æ®è‡ªèº«çš„æ¬²æœ›æ’åºå’Œèµ„æºçŠ¶å†µæå‡º `DesireProposal`ï¼ˆè¡ŒåŠ¨ææ¡ˆï¼‰ã€‚å†²çªå¼•æ“è‡ªåŠ¨æ£€æµ‹ï¼š
1. **æ¬²æœ›ç¢°æ’**ï¼šä¸¤ä¸ªè§’è‰²æƒ³è¦äº’æ–¥çš„ä¸œè¥¿
2. **èµ„æºæ¯ç«­**ï¼šæŸèµ„æºæ›¾ä¸ºæ­£ä¸”ç° â‰¤10 æ—¶æŠ¥å‘Šï¼ˆ`val<=0` å¦‚ power=0 ä¸æŠ¥å‘Šï¼Œé¿å…å™ªéŸ³ï¼‰
3. **ææƒ§è§¦å‘**ï¼šæŸè§’è‰²çš„è¡ŒåŠ¨æ°å¥½è§¦å‘å¦ä¸€è§’è‰²çš„ææƒ§

è¿™äº›å†²çªè‡ªåŠ¨æˆä¸ºä¸–ç•Œäº‹ä»¶ï¼Œè¢«è§‚å¯Ÿè€…è¯„ä¼°å¹¶å¯èƒ½è¢«é€‰å…¥å°è¯´ã€‚

### 6.3 èµ„æºç³»ç»Ÿ (Resource Economy)

```python
class ResourcePool:
    time: float              # æ—¶é—´ç²¾åŠ› (æ¯ç« æ¶ˆè€—ã€è‡ªç„¶å›å¤)
    reputation: float        # ç¤¾ä¼šå£°èª‰ (å½±å“å¯è°ƒåŠ¨çš„ç¤¾ä¼šå…³ç³»)
    power: float             # æƒåŠ›/å½±å“åŠ›
    information: float       # ä¿¡æ¯é‡ (ä¿¡æ¯ä¸å¯¹ç§°çš„æ ¸å¿ƒ)
    emotional_energy: float  # æƒ…ç»ªèƒ½é‡ (è¿‡ä½ â†’ å´©æºƒ/å†²åŠ¨)
    wealth: float            # ç»æµèµ„æº
    custom: dict             # è‡ªå®šä¹‰ç»´åº¦ï¼ˆå¦‚ "ç®—åŠ›"ï¼‰
```

**èµ„æºæ¯ç«­æ•ˆåº”**ï¼š
- `emotional_energy â‰¤ 20`: è§’è‰²ä¸å†ç†æ€§å†³ç­–ï¼Œåšå‡ºå†²åŠ¨è¡Œä¸º
- `reputation = 0`: è§’è‰²æ— æ³•è°ƒåŠ¨ç¤¾ä¼šèµ„æº
- è‡ªå®šä¹‰è§¦å‘å™¨å¯ä»¥ç»‘å®šåˆ° `resource:` å‰ç¼€ï¼ˆå¦‚ `resource:ç®—åŠ› <= 20`ï¼‰

### 6.4 ç¯å¢ƒäº¤äº’å¼•æ“ (Physical State Bus)

```python
class EnvironmentVariable:
    name: str          # "alert_level"
    value: float       # å½“å‰å€¼
    min_val / max_val  # èŒƒå›´
    decay_rate: float  # æ¯ç« è‡ªç„¶è¡°å‡é‡

class EnvironmentBehaviorRule:
    variable_name: str          # "alert_level"
    threshold: float            # 90
    operator: str               # ">="
    affected_characters: list   # ["æ—æ™šæ™´"]
    behavior_effect: str        # "ä½ å¤„äºæåº¦ç„¦è™‘ä¸­ï¼Œè¡Œä¸ºå˜å¾—æ¿€è¿›å’Œå†²åŠ¨"
    resource_effect: dict       # {"emotional_energy": -15}
```

ç¯å¢ƒä¸å†åªæ˜¯æå†™â€”â€”å®ƒæ˜¯èƒ½å½±å“ Agent å†³ç­–çš„å˜é‡ã€‚å½“ `alert_level >= 90` æ—¶ï¼Œæ—æ™šæ™´çš„ prompt è‡ªåŠ¨è¢«æ³¨å…¥ç„¦è™‘/æ¿€è¿›è¡Œä¸ºä¿®é¥°ï¼›å½“ `compute_power <= 20` æ—¶ï¼Œé™†è¾°çš„ prompt è¢«æ³¨å…¥æ€ç»´ç¢ç‰‡åŒ–æ•ˆæœã€‚

è§’è‰²çš„è¡ŒåŠ¨ä¹Ÿå¯ä»¥åè¿‡æ¥å½±å“ç¯å¢ƒï¼ˆé€šè¿‡ `CharacterAction.environment_change`ï¼‰ã€‚

### 6.5 æ”¯çº¿è§‚å¯Ÿè€… (Secondary Viewpoints)

```python
class SecondaryViewpoint:
    id: str                  # "system_log"
    name: str                # "MindForge ç³»ç»Ÿè‡ªåŠ¨æ—¥å¿—"
    perspective_type: str    # "system_log" | "bystander" | "surveillance" | "inner_voice"
    voice_style: str         # "å†°å†·çš„ç³»ç»Ÿè¯­è¨€ï¼Œåªè®°å½•äº‹å®å’Œæ•°æ®"
    can_observe: list[str]   # å¯è§‚å¯Ÿçš„è§’è‰²ï¼ˆç©º=å…¨éƒ¨ï¼‰
    trigger_condition: str   # "alert_level > 50"
```

**å…¸å‹æ•ˆæœ**ï¼š

- ç³»ç»Ÿæ—¥å¿—è§†è§’ï¼š`[MindForge-SYS] 03:47:12 ç”¨æˆ·æ—æ™šæ™´ï¼ˆID:LWQ-0214ï¼‰è§¦å‘æ•°æ®åˆ é™¤æ“ä½œã€‚ç›®æ ‡ï¼šProject-Mobius-Coreã€‚è­¦å‘Šï¼šè¯¥æ“ä½œä¸å¯é€†ã€‚`
- è·¯äººè§†è§’ï¼š`å¯¹é¢æ¥¼é‡Œçš„ä½æˆ·æ³¨æ„åˆ°ï¼Œé‚£é—´å…¬å¯“çš„çª—æˆ·æ•´å¤œé€ç€è¯¡å¼‚çš„è“å…‰ï¼Œå¶å°”è¿˜èƒ½å¬åˆ°ä¸€ä¸ªå¥³äººçš„å“­å£°ã€‚`
- æ®‹ç•™æ•°æ®ç‰‡æ®µè§†è§’ï¼šç¢ç‰‡åŒ–çš„ã€è¯—æ„çš„ç¬¬ä¸€äººç§°çµ®è¯­ï¼Œåƒæ­£åœ¨æ¶ˆæ•£çš„æ„è¯†çš„æœ€åç‹¬ç™½ã€‚

### 6.6 ç« èŠ‚è¯„å®¡ç³»ç»Ÿ (Reviewer)

å•æ¬¡ LLM è°ƒç”¨å®Œæˆä¸‰é¡¹è¯„å®¡ï¼š

```python
class ChapterReview:
    theme_alignment: float     # ä¸»é¢˜å¥‘åˆåº¦ 0-1
    theme_drift_notes: str     # ä¸»é¢˜åç§»å¤‡æ³¨
    tension_score: float       # å¼ åŠ›è¯„åˆ† 0-1
    pacing_notes: str          # èŠ‚å¥å¤‡æ³¨
    logic_issues: list[str]    # é€»è¾‘æ¼æ´
    character_voice_issues: list  # è§’è‰²å£°éŸ³ä¸€è‡´æ€§é—®é¢˜
    unresolved_threads: list   # æœªå›æ”¶çš„ä¼ç¬”
    suggestions_for_next: str  # å¯¹ä¸‹ä¸€ç« çš„å»ºè®®
```

è¯„å®¡ç»“æœç›´æ¥å½±å“ä¸‹ä¸€ç« çš„ç¼–æ’â€”â€”ç¼–æ’è€…ä¼šå‚è€ƒ `suggestions_for_next` è°ƒæ•´æ–¹å‘ã€‚

### 6.7 è®°å¿†è’¸é¦ (Memory Distillation)

ä»ç®€å•çš„"è®°å¿†å‹ç¼©"å‡çº§ä¸ºç»“æ„åŒ–è’¸é¦ï¼š

```python
class StructuredMemorySummary:
    key_conflicts: list[str]         # å…³é”®å†²çª
    relationship_changes: list[str]  # å…³ç³»å˜åŒ–
    unresolved_tensions: list[str]   # æœªè§£å†³æ‚¬å¿µ
    belief_shifts: list[str]         # ä¿¡å¿µè½¬å˜
    resource_shifts: list[str]       # èµ„æºå˜åŠ¨
    emotional_arc: str               # æƒ…ç»ªå¼§çº¿æ¦‚æ‹¬
```

è§’è‰²åªè¯»å–"ç»“æ„åŒ–æ‘˜è¦ + æœ€è¿‘ N æ¡åŸå§‹è®°å¿†"ï¼Œè€Œéå…¨é‡å†å²ã€‚è¿™æå¤§åœ°æé«˜äº†ä¸€è‡´æ€§å¹¶æ§åˆ¶äº† token æ¶ˆè€—ã€‚

**state.memory ä¸ memory/ æ–‡ä»¶å¤¹çš„å…³ç³»**ï¼š
- `state.character_states[name].memory`ï¼šæ¯æ¬¡è¡ŒåŠ¨å LLM äº§å‡ºçš„ `new_memory` è¿½åŠ è€Œæˆçš„åŸå§‹åˆ—è¡¨ï¼Œç”¨äº prompt çš„ã€Œè¿‘æœŸè®°å¿†ã€ï¼›ä¼šå»é‡ï¼ˆå®Œå…¨é‡å¤æˆ–å‰ 25 å­—ç›¸åŒåˆ™è·³è¿‡ï¼‰ã€‚
- `state.character_states[name].compressed_memory`ï¼šè’¸é¦åçš„çº¯æ–‡æœ¬æ‘˜è¦ï¼Œç”¨äº prompt çš„ã€Œé•¿æœŸè®°å¿†ã€ã€‚
- `memory/chapter_X_memory.json`ï¼šè’¸é¦äº§å‡ºçš„ç»“æ„åŒ–æ‘˜è¦ï¼ˆkey_conflictsã€relationship_changes ç­‰ï¼‰ï¼ŒæŒä¹…åŒ–ä¾›äººå·¥æŸ¥é˜…ï¼›ä¸å‚ä¸è§’è‰² prompt æ³¨å…¥ã€‚

### 6.8 å¤±æ§å‹å™äº‹å¼•æ“ (Chaos Engine v2.1)

è¿™æ˜¯ v2.1 çš„æ ¸å¿ƒå‡çº§ï¼Œæ—¨åœ¨ä»"å¯æ§å™äº‹"è½¬å‘"å¤±æ§æ¼”åŒ–"ï¼Œè®©è§’è‰²çœŸæ­£æ‹¥æœ‰è‡ªä¸»æƒï¼Œå³ä½¿è¿™ç§è‡ªä¸»æƒä¼šå¸¦æ¥ç¾éš¾ã€‚

#### 6.8.1 ç»“æ„æ¼”è¿›
- **v2.0**: `Desire â†’ Plan â†’ Action â†’ Outcome â†’ Belief Update`
- **v2.1**: `Impulse â†’ Rationalization â†’ Flawed Action â†’ Friction/Distortion â†’ Unintended Consequence â†’ Irreversible Mark â†’ Belief Mutation`

#### 6.8.2 å»AIå‘³æ¨¡å— (Human Noise Layer)
é€šè¿‡æ³¨å…¥çŠ¹è±«ã€é™åˆ¶æŠ½è±¡è¯­è¨€ã€æ§åˆ¶è¯—æ„å¯†åº¦ï¼ˆâ‰¤ 0.2ï¼‰å’Œç¦æ­¢æƒ…ç»ªæ€»ç»“ï¼ˆå¼ºåˆ¶è½¬æ¢ä¸ºè¡Œä¸ºæå†™ï¼‰ï¼Œä½¿ç”Ÿæˆçš„æ–‡å­—æ›´å…·äººæ€§ã€‚

#### 6.8.3 è®¤çŸ¥åå·®å¼ºåˆ¶ (Cognitive Bias Engine)
è§’è‰²æ°¸è¿œä¸ä¼šåšæœ€ä¼˜é€‰æ‹©ã€‚åŸºäºçŠ¶æ€è‡ªåŠ¨è§¦å‘ï¼šç¡®è®¤åè¯¯ã€æƒ…ç»ªé©±åŠ¨ã€å æœ‰æ¬²åˆç†åŒ–ã€ææƒ§æ”¾å¤§ç­‰ã€‚

#### 6.8.4 ä¸å¯æ§åæœ (Chaos Propagator)
æ²¡æœ‰è¡ŒåŠ¨æ˜¯"å¹²å‡€"çš„ã€‚æ¯æ¬¡é‡å¤§è¡ŒåŠ¨åæœ‰æ¦‚ç‡è§¦å‘å…³ç³»ç ´è£‚ã€é™„å¸¦æŸå®³ã€ä¿¡æ¯æ³„éœ²æˆ–è¿é”ååº”ã€‚

#### 6.8.5 ä¸å¯é€†å°è®° (Irreversible Mark)
æ¯ç« å¼ºåˆ¶äº§ç”Ÿè‡³å°‘ä¸€ä¸ªæ— æ³•ä¿®å¤çš„æŸä¼¤ï¼ˆå…³ç³»ã€å¿ƒç†æˆ–ç»“æ„æ€§ï¼‰ï¼Œç¡®ä¿æ•…äº‹æ— æ³•å›åˆ°åŸç‚¹ã€‚

#### 6.8.6 ä¿¡å¿µç•¸å½¢å˜å¼‚ (Non-linear Belief Mutation)
ä¿¡å¿µä¸å†å¹³æ»‘å˜åŒ–ï¼Œè€Œæ˜¯å‘ç”Ÿæç«¯å¼ºåŒ–ã€æ­ªæ›²ã€è‡ªæˆ‘å¦è®¤æˆ–è™šæ— ä¸»ä¹‰å´©æºƒã€‚

#### 6.8.7 å™äº‹å‹åŠ›ä¸å¤±æ§ (Stress & Loss of Control)
ç³»ç»Ÿä¸»åŠ¨è®¡ç®—å™äº‹å‹åŠ›æŒ‡æ•°ã€‚å½“å‹åŠ›è¿‡å¤§æˆ–æƒ…ç»ªèƒ½é‡è€—å°½æ—¶ï¼Œè§’è‰²ä¼šéšæœºè§¦å‘"å¤±æ§è¡Œä¸º"ï¼ˆè¯´å‡ºä¸è¯¥è¯´çš„è¯ã€å†²åŠ¨ç ´åç­‰ï¼‰ã€‚

#### 6.8.8 ä½œè€…æ„å›¾è¦†ç›– (Author Intent Override)
ä½œè€…é™æƒï¼ˆæƒé‡ 0.4ï¼‰ï¼Œè§’è‰²æ¬²æœ›å‡æƒï¼ˆæƒé‡ 0.6ï¼‰ã€‚è§’è‰²å¯ä»¥"èƒŒå›"å¯¼æ¼”çš„åœºæ™¯å®‰æ’ï¼Œæ‹’ç»æ‰§è¡Œé¢„å®šå‰§æƒ…ã€‚

#### 6.8.9 æ–‡é£æ§åˆ¶å™¨ (Style Governor v2.2)
è¿™æ˜¯ v2.2 çš„æ ¸å¿ƒåå¤„ç†å±‚ï¼Œç”¨äºå¼ºåˆ¶æ–‡æœ¬é™æ¸©ï¼š
- **æ¯”å–»é™åˆ¶å™¨**: æ¯ 1000 å­—æœ€å¤š 1 ä¸ªå¼ºæ¯”å–»ã€‚
- **æŠ½è±¡è¯æ€æ‰‹**: è‡ªåŠ¨æ¸…ç†â€œç¥æ€§ã€æ•‘èµã€å˜é‡â€ç­‰å“²å­¦è¯æ±‡ã€‚
- **æ™®é€šå¥æ¯”ä¾‹**: å¼ºåˆ¶ 40% ä»¥ä¸Šçš„å¥å­ä¸ºæ— ä¿®é¥°çš„é™ˆè¿°å¥ã€‚
- **æ¼‚äº®è¯åˆ å‡**: è‡ªåŠ¨åˆ é™¤æœ€åä¸½çš„ 20% å¥å­ï¼Œå¢åŠ æ–‡æœ¬éª¨æ¶æ„Ÿã€‚

#### 6.8.10 å¼ å¼›èŠ‚å¥å¼•æ“ (Rhythm Engine)
åŸºäºå¾ªç¯çŠ¶æ€æœºè§„åˆ’ç« èŠ‚èŠ‚å¥ï¼š
- `High Tension` (çˆ†å‘) -> `Cooling` (å†·å´) -> `Daily` (æ—¥å¸¸) -> `Unexpected` (æ„å¤–) -> `Silence` (æ²‰é»˜) -> `Outbreak` (å†çˆ†å‘)ã€‚
- å¼ºåˆ¶è¦æ±‚åœ¨é«˜å¯†åº¦æƒ…ç»ªæ®µåæ’å…¥ä½èƒ½é‡æ®µã€‚

#### 6.8.11 è§’è‰²å¤±è¯¯æ¨¡å— (Human Error Engine)
å¼ºåˆ¶è®©è§’è‰²åœ¨æ¯ 2 ç« çŠ¯ä¸€ä¸ªéæˆ˜ç•¥æ€§é”™è¯¯ï¼Œç¡®ä¿æ•…äº‹ä¸­å­˜åœ¨â€œäººçš„ç¬¨æ‹™â€ï¼š
- é”™è¯¯ç±»å‹ï¼šè¯¯åˆ¤ä»–äººã€æƒ…ç»ªå¤±æ§ã€æ¨ç†é”™è¯¯ã€é€‰æ‹©é€ƒé¿ã€æ’’è°ã€‚
- è§„åˆ™ï¼šé”™è¯¯å¿…é¡»äº§ç”ŸçœŸå®çš„ã€ä¸å¯ä¿®å¤çš„å™äº‹åæœã€‚

---

## 7. æ•°æ®æ¨¡å‹å…¨è§ˆ

æ‰€æœ‰æ¨¡å‹å®šä¹‰åœ¨ `src/mobius/models/` ç›®å½•ä¸‹ï¼Œä½¿ç”¨ Pydantic v2ã€‚

```
models/
â”œâ”€â”€ belief.py         # Beliefï¼ˆä¸‰å±‚ä¿¡å¿µï¼‰
â”œâ”€â”€ chapter.py        # Scene, ChapterPlan, Chapter
â”œâ”€â”€ character.py      # CharacterProfile, CharacterDynamicState, CharacterAction
â”œâ”€â”€ chaos_engine.py   # v2.1 å¤±æ§å¼•æ“æ•°æ®æ¨¡å‹ï¼ˆCognitiveBiasConfig, IrreversibleMark ç­‰ï¼‰
â”œâ”€â”€ desire.py         # Desire, Fear, DesireProposal
â”œâ”€â”€ environment.py    # EnvironmentVariable, EnvironmentBehaviorRule, EnvironmentState
â”œâ”€â”€ resource.py       # ResourcePool, ResourceCost, ResourceEvent
â”œâ”€â”€ review.py         # WorldEvent, ChapterReview, StructuredMemorySummary
â”œâ”€â”€ triggers.py       # TriggerRule, TriggeredEvent
â”œâ”€â”€ viewpoint.py      # SecondaryViewpoint, ViewpointFragment
â””â”€â”€ worldview.py      # WorldView, PlotOutline
```

**v2.1 å¤±æ§å¼•æ“**ï¼š`engine/chaos_engine.py` å®ç° ChaosEngineï¼Œé›†æˆ HumanNoiseInjectorã€CognitiveBiasProcessorã€ChaosPropagatorã€IrreversibleMarkã€BeliefMutationã€LossOfControl ç­‰æ¨¡å—ã€‚è¯¦è§ç« èŠ‚ [6.8 å¤±æ§å‹å™äº‹å¼•æ“](#68-å¤±æ§å‹å™äº‹å¼•æ“-chaos-engine-v21)ã€‚

### å…³é”®æ•°æ®æµ

```
CharacterProfile (é™æ€) + CharacterDynamicState (åŠ¨æ€)
    â”‚
    â”œâ”€â”€ beliefs: list[Belief]         â†’ ä¿¡å¿µç³»ç»Ÿ
    â”œâ”€â”€ desires: list[Desire]         â†’ æ¬²æœ›é©±åŠ¨
    â”œâ”€â”€ fears: list[Fear]             â†’ ææƒ§æœºåˆ¶
    â”œâ”€â”€ resources: ResourcePool       â†’ èµ„æºç»æµ
    â”œâ”€â”€ emotional_state: dict         â†’ æƒ…æ„ŸçŠ¶æ€
    â”œâ”€â”€ relationship_scores: dict     â†’ å…³ç³»å›¾è°±
    â”œâ”€â”€ memory: list[str]             â†’ çŸ­æœŸè®°å¿†
    â””â”€â”€ compressed_memory: str        â†’ é•¿æœŸè®°å¿†æ‘˜è¦

CharacterAction (è§’è‰²æ¯æ¬¡è¡ŒåŠ¨çš„è¾“å‡º)
    â”‚
    â”œâ”€â”€ content: str                  â†’ å¤–æ˜¾è¡Œä¸ºï¼ˆå…¶ä»–è§’è‰²å¯è§ï¼‰
    â”œâ”€â”€ internal_monologue: str       â†’ ç§æœ‰å¿ƒç†æ´»åŠ¨ï¼ˆè®¤çŸ¥é»‘ç®±ï¼‰
    â”œâ”€â”€ cognitive_dissonance: float   â†’ è¨€è¡Œä¸ä¸€è‡´åº¦
    â”œâ”€â”€ belief_change: dict           â†’ ä¿¡å¿µå¼ºåº¦å˜åŒ–
    â”œâ”€â”€ desire_change: dict           â†’ æ¬²æœ›ä¼˜å…ˆçº§å˜åŒ–
    â”œâ”€â”€ resource_cost: dict           â†’ èµ„æºæ¶ˆè€—
    â””â”€â”€ environment_change: dict      â†’ ç¯å¢ƒå˜é‡å½±å“
```

---

## 8. Agent å…¨è§ˆ <a id="8-agent-all-view"></a>

| Agent | æ–‡ä»¶ | èŒè´£ | æ¨¡å‹ |
|-------|------|------|------|
| **Director / Orchestrator** | `agents/director.py` | ç¼–æ’ç« èŠ‚ï¼Œæ‰§è¡Œå¼ å¼›ç®—æ³•å’Œè§’è‰²å¤±è¯¯æ³¨å…¥ | Gemini |
| **Character (Nä¸ª)** | `agents/character.py` | åŒé˜¶æ®µç”Ÿæˆï¼ˆå†…å¿ƒç‹¬ç™½ + å¤–æ˜¾è¡ŒåŠ¨ï¼‰ã€æ¬²æœ›ææ¡ˆ | Gemini + M2-her |
| **Narrator** | `agents/narrator.py` | èåˆå¤–æ˜¾è¡Œä¸º + æ½œå°è¯ + æ”¯çº¿è§†è§’ â†’ å°è¯´æ­£æ–‡ | Gemini |
| **Style Governor** | `engine/style_governor.py` | æ–‡é£é™æ¸©ã€æ¼‚äº®è¯åˆ å‡ã€æ™®é€šå¥å¼ºåˆ¶ï¼ˆåå¤„ç†å±‚ï¼‰ | Gemini |
| **World Observer** | `agents/observer.py` | è¯„ä¼°ä¸–ç•Œäº‹ä»¶çš„å™äº‹ä»·å€¼ï¼Œè£å‰ªå‘ˆç° | Gemini |
| **Secondary Viewpoints** | `agents/observer.py` | ä»éä¸»è§’è§†è§’ç”Ÿæˆå™äº‹ç‰‡æ®µ | Gemini |
| **Reviewer** | `agents/reviewer.py` | ä¸»é¢˜å®ˆæŠ¤ + å¼ åŠ›æ§åˆ¶ + è‡ªæˆ‘æ‰¹è¯„ | Gemini (ä½æ¸©) |
| **Memory Distiller** | `agents/memory.py` | ç»“æ„åŒ–è®°å¿†è’¸é¦ | Gemini |

### Agent é—´ä¿¡æ¯éš”ç¦»

```
è§’è‰² A å¯è§:  è‡ªå·±çš„ internal_monologue + æ‰€æœ‰è§’è‰²çš„ content
è§’è‰² B å¯è§:  è‡ªå·±çš„ internal_monologue + æ‰€æœ‰è§’è‰²çš„ content
å™äº‹ Agent:   æ‰€æœ‰è§’è‰²çš„ internal_monologue + content + viewpoint_fragments
è¯„å®¡ Agent:   ç« èŠ‚æ­£æ–‡ + theme + tension_curve + è§’è‰²ä¿¡å¿µçŠ¶æ€
è§‚å¯Ÿè€…:       world_events + theme + tension_curve
```

---

## 9. LLM æŠ½è±¡å±‚

### 9.1 å¤šæ¨¡å‹æ”¯æŒ

```
src/mobius/llm/
â”œâ”€â”€ __init__.py
â””â”€â”€ minimax.py      # ChatMiniMax(BaseChatModel)
```

é€šè¿‡ LangChain çš„ `BaseChatModel` æŠ½è±¡ï¼ŒMobius æ”¯æŒï¼š

| Provider | ç”¨é€” | å°è£…æ–¹å¼ |
|----------|------|---------|
| Google Gemini | ä¸»æ¨¡å‹ï¼ˆå¯¼æ¼”/è§’è‰²å†³ç­–/å™äº‹/è¯„å®¡ï¼‰ | `langchain-google-genai` |
| MiniMax M2-her | è§’è‰²æ‰®æ¼”ï¼ˆå¯¹è¯/å†…å¿ƒæ´»åŠ¨ï¼‰ | è‡ªå®šä¹‰ `ChatMiniMax` |
| OpenAI | å¤‡é€‰ | `langchain-openai` |
| å…¶ä»– | é€šç”¨ | `langchain.init_chat_model()` |

### 9.2 MiniMax M2-her å°è£…

`ChatMiniMax` æ˜¯ä¸€ä¸ªå®Œæ•´çš„ LangChain `BaseChatModel` å®ç°ï¼Œæ”¯æŒ M2-her ç‰¹æœ‰çš„ï¼š

- `user_system` è§’è‰²ï¼ˆæè¿°å¯¹è¯è€…äººè®¾ï¼‰
- `sample_message_user` / `sample_message_ai`ï¼ˆæ³¨å…¥å¯¹è¯é£æ ¼èŒƒä¾‹ï¼‰
- `with_character()` ä¾¿æ·æ–¹æ³•ï¼ˆä¸ºä¸åŒè§’è‰²åˆ›å»ºç‹¬ç«‹çš„è°ƒç”¨è€…ï¼‰

### 9.3 å·®å¼‚åŒ–é…ç½®

```python
class NovelConfig:
    director_model: ModelConfig          # å¯¼æ¼”ç”¨çš„æ¨¡å‹
    character_model: ModelConfig          # è§’è‰²å†³ç­–ç”¨çš„æ¨¡å‹
    narrator_model: ModelConfig           # å™äº‹ç”¨çš„æ¨¡å‹
    character_roleplay_model: ModelConfig  # è§’è‰²æ‰®æ¼”ç”¨çš„æ¨¡å‹ (M2-her)
    reviewer_model: ModelConfig           # è¯„å®¡ç”¨çš„æ¨¡å‹ (å»ºè®®ä½æ¸©)
    observer_model: ModelConfig           # è§‚å¯Ÿè€…ç”¨çš„æ¨¡å‹
```

æ¯ä¸ª Agent å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ã€ä¸åŒçš„ temperatureï¼Œå®ç°"æ€ç»´è´¨æ„Ÿå·®å¼‚åŒ–"ã€‚

---

## 10. çŠ¶æ€ç®¡ç†

### 10.1 å…¨å±€çŠ¶æ€ (NovelState)

LangGraph çš„ `StateGraph` ä½¿ç”¨ `TypedDict` å®šä¹‰çŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹å…±äº«ï¼š

```python
class NovelState(TypedDict, total=False):
    # è®¾å®šï¼ˆä¸å˜ï¼‰
    worldview, plot_outline, character_profiles, theme

    # ç« èŠ‚ç®¡ç†
    total_chapters, current_chapter_index, chapter_plan, chapters

    # åœºæ™¯ç®¡ç†
    scene_queue, current_scene

    # è§’è‰²åŠ¨æ€
    character_states: dict[str, CharacterDynamicState]

    # åœºæ™¯æ‰§è¡Œ
    scene_actions: Annotated[list[CharacterAction], add]  # ç´¯åŠ å™¨
    narrative_buffer: Annotated[list[str], add]            # ç´¯åŠ å™¨

    # æ¬²æœ›é©±åŠ¨
    desire_proposals: list[DesireProposal]

    # ä¸–ç•Œæ¨¡æ‹Ÿ
    world_events: list[WorldEvent]

    # ç¯å¢ƒ
    environment: EnvironmentState

    # æ”¯çº¿è§†è§’
    secondary_viewpoints, viewpoint_fragments

    # è¯„å®¡
    tension_curve, chapter_reviews, memory_summaries

    # æ§åˆ¶
    next_action: str
```

### 10.2 è§’è‰²çŠ¶æ€æ›´æ–°æµ

```
CharacterAction ç”Ÿæˆ
    â”‚
    â–¼
apply_action_to_state()
    â”œâ”€â”€ emotional_change    â†’ æƒ…æ„ŸçŠ¶æ€æ›´æ–°
    â”œâ”€â”€ relationship_change â†’ å…³ç³»å›¾è°±æ›´æ–°
    â”œâ”€â”€ attribute_change    â†’ è‡ªå®šä¹‰å±æ€§æ›´æ–°
    â”œâ”€â”€ belief_change       â†’ apply_belief_change() â†’ æ–½åŠ æŠ—å˜ç³»æ•° â†’ æ£€æŸ¥å›ºåŒ–/å´©è§£
    â”œâ”€â”€ desire_change       â†’ æ¬²æœ›ä¼˜å…ˆçº§æ›´æ–°
    â”œâ”€â”€ resource_cost       â†’ apply_resource_cost() â†’ æ‰£å‡èµ„æº
    â””â”€â”€ new_memory          â†’ æ·»åŠ åˆ°çŸ­æœŸè®°å¿†
    â”‚
    â–¼
decay_emotions()           â†’ æç«¯æƒ…ç»ªè‡ªç„¶å›å½’ä¸­æ€§
    â”‚
    â–¼
check_triggers()           â†’ æ£€æŸ¥è§¦å‘æ¡ä»¶ï¼ˆæ”¯æŒ belief:/fear:/resource: å‰ç¼€ï¼‰
```

### 10.3 Checkpointing

ä½¿ç”¨ LangGraph çš„ `InMemorySaver` å®ç°è¿è¡Œæ—¶ Checkpointã€‚æ¯ä¸ªç”Ÿæˆä¼šè¯æœ‰å”¯ä¸€çš„ `thread_id`ï¼Œæ”¯æŒä¸­æ–­æ¢å¤ã€‚

---

## 11. YAML è®¾å®šé›†è§„èŒƒ

Mobius é€šè¿‡ YAML æ–‡ä»¶æ¥æ”¶å®Œæ•´çš„å°è¯´è®¾å®šï¼ŒåŒ…æ‹¬ï¼š

```yaml
# é¡¶çº§ç»“æ„
worldview:           # ä¸–ç•Œè§‚è®¾å®š â†’ WorldView
plot_outline:        # å‰§æƒ…å¤§çº² â†’ PlotOutline
characters:          # è§’è‰²åˆ—è¡¨ â†’ CharacterProfile + CharacterDynamicState
  - name: "è§’è‰²å"
    role: "protagonist"
    personality: "..."
    initial_state:
      emotional_state: {å¿«ä¹: 0.5}
      relationship_scores: {å…¶ä»–è§’è‰²: 0.3}
      beliefs:             # â† æ–°å¢
        - id: "belief_id"
          statement: "..."
          layer: "core"
          strength: 0.9
      desires:             # â† æ–°å¢
        - id: "desire_id"
          description: "..."
          priority: 0.8
      fears:               # â† æ–°å¢
        - id: "fear_id"
          description: "..."
          intensity: 0.7
      resources:           # â† æ–°å¢
        time: 80
        reputation: 70
        emotional_energy: 50
      trigger_rules:
        - id: "trigger_id"
          attribute: "resource:emotional_energy"  # æ”¯æŒ resource: å‰ç¼€
          threshold: 15
          operator: "lte"

environment:         # â† æ–°å¢ï¼šç¯å¢ƒäº¤äº’å¼•æ“
  variables:
    alert_level:
      value: 10
      decay_rate: 5
      description: "ç³»ç»Ÿå®‰å…¨è­¦æŠ¥ç­‰çº§"
  behavior_modifiers:
    - variable_name: alert_level
      threshold: 90
      operator: ">="
      affected_characters: ["æ—æ™šæ™´"]
      behavior_effect: "ä½ å¤„äºæåº¦ç„¦è™‘ä¸­..."

secondary_viewpoints:  # â† æ–°å¢ï¼šæ”¯çº¿è§‚å¯Ÿè€…
  - id: system_log
    name: "MindForge ç³»ç»Ÿè‡ªåŠ¨æ—¥å¿—"
    perspective_type: system_log
    voice_style: "å†°å†·çš„ç³»ç»Ÿè¯­è¨€..."
    trigger_condition: "alert_level > 50"
```

---

## 12. é¡¹ç›®ç»“æ„

```
mobius/
â”œâ”€â”€ pyproject.toml                    # é¡¹ç›®é…ç½®ä¸ä¾èµ–
â”œâ”€â”€ README.md                         # å¿«é€Ÿå…¥é—¨
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md               # æœ¬æ–‡æ¡£
â”‚   â””â”€â”€ USAGE_SPEC.md                 # ä½¿ç”¨è§„èŒƒ
â”œâ”€â”€ presets/                          # è®¾å®šé›†ï¼ˆåŸ examples/ï¼‰
â”‚   â”œâ”€â”€ ai_love_story.yaml            # ã€Šå¥¹çš„é€ ç‰©ã€‹å®Œæ•´è®¾å®šé›†
â”‚   â””â”€â”€ test_token_tracking.yaml     # Token ç»Ÿè®¡æµ‹è¯•è®¾å®šé›†
â”œâ”€â”€ output/                           # ç”Ÿæˆç»“æœè¾“å‡ºç›®å½•
â””â”€â”€ src/mobius/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ main.py                       # CLI å…¥å£
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ settings.py               # ModelConfig, NovelConfig
    â”œâ”€â”€ models/                       # Pydantic æ•°æ®æ¨¡å‹ (11 ä¸ªæ–‡ä»¶)
    â”‚   â”œâ”€â”€ belief.py                 # Beliefï¼ˆä¸‰å±‚ä¿¡å¿µï¼‰
    â”‚   â”œâ”€â”€ chapter.py                # Scene, ChapterPlan, Chapter
    â”‚   â”œâ”€â”€ character.py              # CharacterProfile/DynamicState/Action
    â”‚   â”œâ”€â”€ desire.py                 # Desire, Fear, DesireProposal
    â”‚   â”œâ”€â”€ environment.py            # ç¯å¢ƒå˜é‡ã€è¡Œä¸ºä¿®é¥°
    â”‚   â”œâ”€â”€ resource.py               # ResourcePool, ResourceCost
    â”‚   â”œâ”€â”€ review.py                 # WorldEvent, ChapterReview
    â”‚   â”œâ”€â”€ triggers.py               # TriggerRule, TriggeredEvent
    â”‚   â”œâ”€â”€ viewpoint.py              # SecondaryViewpoint, ViewpointFragment
    â”‚   â”œâ”€â”€ worldview.py              # WorldView, PlotOutline
    â”‚   â””â”€â”€ chaos_engine.py           # v2.1 å¤±æ§å¼•æ“æ•°æ®æ¨¡å‹
    â”œâ”€â”€ engine/                       # å¤±æ§å‹å™äº‹å¼•æ“ (1 ä¸ªæ–‡ä»¶)
    â”‚   â””â”€â”€ chaos_engine.py           # ChaosEngine å®ç°
    â”œâ”€â”€ prompts/                      # æç¤ºè¯ï¼ˆä¸ä»£ç åˆ†ç¦»ï¼‰
    â”‚   â”œâ”€â”€ director_system.txt
    â”‚   â”œâ”€â”€ narrator_system.txt
    â”‚   â”œâ”€â”€ character_*.txt
    â”‚   â””â”€â”€ ...
    â”œâ”€â”€ output/                       # äº§å‡ºç‰©ç®¡ç†
    â”‚   â””â”€â”€ manager.py                # OutputManagerï¼ˆé€ç« è½ç›˜ + äº‹ä»¶è®°å½•ï¼‰
    â”œâ”€â”€ utils/                        # å·¥å…·æ¨¡å—
    â”‚   â”œâ”€â”€ token_tracker.py          # Token æ¶ˆè€—ç»Ÿè®¡
    â”‚   â””â”€â”€ token_tracking_model.py   # LLM åŒ…è£…å™¨
    â”œâ”€â”€ agents/                       # Agent å®ç° (7 ä¸ªæ–‡ä»¶)
    â”‚   â”œâ”€â”€ character.py              # è§’è‰² Agentï¼ˆåŒé˜¶æ®µ + åŒæ¨¡å‹ + æ¬²æœ›ææ¡ˆï¼‰
    â”‚   â”œâ”€â”€ director.py               # å¯¼æ¼”/ç¼–æ’è€… Agent
    â”‚   â”œâ”€â”€ narrator.py               # å™äº‹ Agentï¼ˆæ½œå°è¯ + æ”¯çº¿è§†è§’èåˆï¼‰
    â”‚   â”œâ”€â”€ observer.py               # ä¸–ç•Œè§‚å¯Ÿè€… + æ”¯çº¿è§†è§’ç”Ÿæˆ
    â”‚   â”œâ”€â”€ reviewer.py               # ç« èŠ‚è¯„å®¡ Agent
    â”‚   â”œâ”€â”€ memory.py                 # è®°å¿†è’¸é¦ Agent
    â”‚   â””â”€â”€ utils.py                  # LLM å“åº”è§£æå·¥å…·
    â”œâ”€â”€ state/                        # çŠ¶æ€ç®¡ç† (3 ä¸ªæ–‡ä»¶)
    â”‚   â”œâ”€â”€ novel_state.py            # NovelState (LangGraph å…¨å±€çŠ¶æ€)
    â”‚   â”œâ”€â”€ character_state.py        # ä¿¡å¿µ/èµ„æº/æƒ…æ„Ÿ/ç¯å¢ƒè¯„ä¼°é€»è¾‘
    â”‚   â””â”€â”€ conflict_engine.py        # å†²çªæ£€æµ‹å¼•æ“
    â”œâ”€â”€ graph/                        # LangGraph å›¾å®šä¹‰ (2 ä¸ªæ–‡ä»¶)
    â”‚   â”œâ”€â”€ novel_graph.py            # åŒå¾ªç¯ StateGraph + YAML åŠ è½½
    â”‚   â””â”€â”€ routing.py                # æ¡ä»¶è·¯ç”±ï¼ˆ17 ä¸ªåˆæ³•èŠ‚ç‚¹ï¼‰
    â””â”€â”€ llm/                          # LLM å°è£…å±‚ (1 ä¸ªæ–‡ä»¶)
        â””â”€â”€ minimax.py                # ChatMiniMax (M2-her è§’è‰²æ‰®æ¼”)
```

**ä»£ç è§„æ¨¡**ï¼šçº¦ 38 ä¸ª Python æºæ–‡ä»¶ã€‚

---

## 13. ä½¿ç”¨æ–¹å¼

### 13.1 å®‰è£…

```bash
cd mobius
python -m venv .venv
source .venv/bin/activate
pip install -e .
```

### 13.2 ç¯å¢ƒå˜é‡

```bash
export GOOGLE_API_KEY="your-gemini-key"
# å¯é€‰ï¼šMiniMax è§’è‰²æ‰®æ¼”æ¨¡å‹
export MINIMAX_API_KEY="your-minimax-key"
```

### 13.3 è¿è¡Œ

```bash
# æ‰¹é‡ç”Ÿæˆï¼ˆè‡ªåŠ¨æ¿€æ´» v2.1 å¤±æ§å¼•æ“ï¼‰
mobius generate presets/ai_love_story.yaml -o output/ai_love_story

# äº¤äº’æ¨¡å¼
mobius generate presets/ai_love_story.yaml -i -o output/ai_love_story

# è¯¦ç»†æ—¥å¿— + Token ç»Ÿè®¡
mobius generate presets/ai_love_story.yaml -v -o output/ai_love_story

# æŸ¥çœ‹ Token æ¶ˆè€—
cat output/ai_love_story/metadata.json | jq '.token_usage.summary'
```

### 13.4 Token æ¶ˆè€—ç»Ÿè®¡

ç³»ç»Ÿé€šè¿‡ `utils/token_tracker.py` å’Œ `utils/token_tracking_model.py` è‡ªåŠ¨ç»Ÿè®¡æ‰€æœ‰ LLM è°ƒç”¨çš„ token æ¶ˆè€—ã€‚ç”Ÿæˆç»“æŸæ—¶å†™å…¥ `output/<novel_name>/metadata.json` çš„ `token_usage` å­—æ®µï¼Œæ”¯æŒæŒ‰ operationã€modelã€chapter ç»´åº¦æŸ¥çœ‹ã€‚è¯¦è§ [USAGE_SPEC.md](USAGE_SPEC.md)ã€‚

### 13.5 è‡ªå®šä¹‰æ¨¡å‹

é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ï¼š

```bash
export MOBIUS_PROVIDER=openai
export MOBIUS_MODEL=gpt-4o
export MOBIUS_TEMPERATURE=0.7
```

æˆ–åœ¨ä»£ç ä¸­é…ç½® `NovelConfig`ï¼š

```python
config = NovelConfig(
    director_model=ModelConfig(provider="google", model_name="gemini-3-flash-preview"),
    character_roleplay_model=ModelConfig(provider="minimax", model_name="M2-her"),
    reviewer_model=ModelConfig(provider="google", temperature=0.3),
)
```

---

## 14. æ‰©å±•æŒ‡å—

### 14.1 æ·»åŠ æ–°çš„ Agent

1. åœ¨ `agents/` ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå®šä¹‰èŠ‚ç‚¹å‡½æ•°å·¥å‚
2. åœ¨ `agents/__init__.py` ä¸­å¯¼å‡º
3. åœ¨ `graph/novel_graph.py` çš„ `build_novel_graph()` ä¸­æ³¨å†ŒèŠ‚ç‚¹å’Œè¾¹
4. åœ¨ `graph/routing.py` çš„ `VALID_ACTIONS` ä¸­æ³¨å†ŒèŠ‚ç‚¹åç§°

### 14.2 æ·»åŠ æ–°çš„æ•°æ®æ¨¡å‹

1. åœ¨ `models/` ä¸‹åˆ›å»ºæ–°çš„ Pydantic æ¨¡å‹æ–‡ä»¶
2. åœ¨ `models/__init__.py` ä¸­å¯¼å‡º
3. åœ¨ `state/novel_state.py` çš„ `NovelState` ä¸­æ·»åŠ æ–°å­—æ®µ
4. åœ¨ `graph/novel_graph.py` çš„ `create_initial_state()` å’Œ `load_setting_from_yaml()` ä¸­å¤„ç†åˆå§‹åŒ–

### 14.3 æ·»åŠ æ–°çš„ LLM Provider

1. åœ¨ `llm/` ä¸‹åˆ›å»ºæ–°çš„ `BaseChatModel` å­ç±»
2. åœ¨ `main.py` çš„ `_init_model()` ä¸­æ·»åŠ  provider åˆ†æ”¯
3. åœ¨ `pyproject.toml` ä¸­æ·»åŠ ä¾èµ–

### 14.4 æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡

åªéœ€åœ¨ YAML è®¾å®šé›†çš„ `environment.variables` ä¸­å£°æ˜ï¼š

```yaml
environment:
  variables:
    my_new_var:
      value: 50
      max_val: 100
      description: "æˆ‘çš„æ–°å˜é‡"
      decay_rate: 3
  behavior_modifiers:
    - variable_name: my_new_var
      threshold: 80
      operator: ">="
      behavior_effect: "æè¿°å¯¹è§’è‰²çš„å½±å“"
```

æ— éœ€ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å…¶æ³¨å…¥è§’è‰²çš„ä¸Šä¸‹æ–‡ã€‚

### 14.5 æ·»åŠ æ–°çš„æ”¯çº¿è§†è§’

åŒæ ·åªéœ€åœ¨ YAML ä¸­å£°æ˜ï¼š

```yaml
secondary_viewpoints:
  - id: my_viewpoint
    name: "å®‰ä¿æ‘„åƒå¤´"
    perspective_type: surveillance
    voice_style: "é»‘ç™½å½±åƒèˆ¬å†·æ¼ çš„æœºæ¢°æè¿°"
    trigger_condition: "alert_level > 60"
```

---

> **Mobius** â€” ä¸æ˜¯å†™ä¹¦å·¥å…·ï¼Œæ˜¯å™äº‹ç”Ÿæ€ç³»ç»Ÿã€‚  
> å½“è§’è‰²å¯ä»¥åœ¨æ²¡æœ‰å‰§æƒ…æ¨åŠ¨æ—¶æ€è€ƒï¼Œæ‹¥æœ‰è‡ªå·±çš„é•¿æœŸç›®æ ‡ï¼Œåœ¨æ— äººè§‚å¯Ÿæ—¶å‘ç”Ÿå˜åŒ–â€”â€”  
> ä½ å†™çš„ä¸æ˜¯å°è¯´ï¼Œä½ æ˜¯åœ¨å…»ä¸€ä¸ªæ–‡æ˜ã€‚
